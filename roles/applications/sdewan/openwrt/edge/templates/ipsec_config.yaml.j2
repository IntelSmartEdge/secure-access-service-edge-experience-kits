{% if item.rules %}
{% for i in item.rules %}
{% if i.type == "tunnelhost" %}
# INTEL CONFIDENTIAL
#
# Copyright 2021-2021 Intel Corporation.
#
# This software and the related documents are Intel copyrighted materials, and your use of
# them is governed by the express license under which they were provided to you ("License").
# Unless the License provides otherwise, you may not use, modify, copy, publish, distribute,
# disclose or transmit this software or the related documents without Intel's prior written permission.
#
# This software and the related documents are provided as is, with no express or implied warranties,
# other than those that are expressly stated in the License.

---

apiVersion: batch.sdewan.akraino.org/v1alpha1
kind: IpsecHost
metadata:
  name: ipsechost
  namespace: cnf
  labels:
    sdewanPurpose: {{ item.name }}
spec:
    name: {{ i.name }}
    remote: {{ i.remote }}
    pre_shared_key: test_key
    authentication_method: psk
    local_identifier: {{ i.local_identifier }}
    crypto_proposal:
      - ipsecproposal
    force_crypto_proposal: "0"
    connections:
    - name: connA
      conn_type: tunnel
      mode: start
{% if i.local_sourceip is defined %}
      local_sourceip: {{ i.local_sourceip }}
{% else %}
      local_sourceip: "%config"
{% endif %}
      remote_subnet: {{ i.remote_subnet }}
      crypto_proposal:
        - ipsecproposal
{% endif %}
{% endfor %}
{% endif %}